{% extends 'base/base.html' %}

{% block title %}Ministry Programs - BM Parliament{% endblock %}
{% block meta_description %}Curated selection of Bangsamoro ministry programs designed for easy access and streamlined application processes{% endblock %}

{% block extra_head %}
{% include 'components/behaviors/common_behaviors.html' %}
{% include 'components/animations/scroll_animations.html' %}
{% endblock %}

{% block hero %}
<div class="bg-gradient-hero text-white py-12">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">Ministry Programs</h1>
            <p class="text-xl text-white/90">{{ description }}</p>
        </div>
    </div>
</div>
{% endblock %}

{% block breadcrumbs %}
<div class="bg-white border-b">
    <div class="container mx-auto px-4 py-3">
        <div class="flex items-center text-sm text-gray-600">
            <a href="{% url 'home' %}" class="hover:text-primary-600 transition">Home</a>
            <i class="fas fa-chevron-right text-xs mx-2"></i>
            <span class="text-gray-800 font-medium">Ministry Programs</span>
        </div>
    </div>
</div>

{% endblock %}
{% block content %}
<!-- Ministry Program Filters -->
<div class="bg-white rounded-lg shadow-sm p-6 border border-gray-100 mb-8">
    <h2 class="text-xl font-semibold text-slate-800 mb-4">Browse Ministry Programs</h2>
    <p class="text-gray-600 mb-6">Filter ministry programs by sector to find government services and support programs that match your needs.</p>
    
    <div class="flex flex-wrap gap-2" x-data="staggerAnimation({staggerDelay: 50})">
        <a href="{% url 'accessible_ministry_programs' %}" 
           class="{% if not current_sector %}{% else %}bg-white border border-gray-300 text-gray-700 hover:bg-gray-50{% endif %} px-4 py-2 rounded-md transition-all duration-300 animate-fade-in-up hover-scale focus-ring flex items-center"
           {% if not current_sector %}style="background: linear-gradient(135deg, #1e40af 0%, #059669 100%); color: white;" onmouseover="this.style.background='linear-gradient(135deg, #1e3a8a 0%, #047857 100%)';" onmouseout="this.style.background='linear-gradient(135deg, #1e40af 0%, #059669 100%)';"{% endif %}>
            <i class="fas fa-th-large mr-2"></i>
            All Programs
        </a>
        {% for sector in sectors %}
        <a href="{% url 'accessible_ministry_programs' %}?sector={{ sector.code }}" 
           class="{% if current_sector == sector.code %}{% else %}bg-white border border-gray-300 text-gray-700 hover:bg-gray-50{% endif %} px-4 py-2 rounded-md transition-all duration-300 animate-fade-in-up hover-scale focus-ring flex items-center"
           {% if current_sector == sector.code %}style="background: linear-gradient(135deg, #1e40af 0%, #059669 100%); color: white;" onmouseover="this.style.background='linear-gradient(135deg, #1e3a8a 0%, #047857 100%)';" onmouseout="this.style.background='linear-gradient(135deg, #1e40af 0%, #059669 100%)';"{% endif %}>
            <i class="{{ sector.icon }} text-{{ sector.color }}-500 mr-2"></i>
            {{ sector.name }}
            <span class="ml-2 text-xs {% if current_sector == sector.code %}text-white/80{% else %}text-gray-500{% endif %}">({{ sector.count }})</span>
        </a>
        {% endfor %}
    </div>
    
    <!-- Sort Options -->
    <div class="mt-4 pt-4 border-t border-gray-200">
        <label class="text-sm font-medium text-gray-700 mr-2">Sort by:</label>
        <select onchange="window.location.href='{% url 'accessible_ministry_programs' %}{% if current_sector %}?sector={{ current_sector }}&{% else %}?{% endif %}sort=' + this.value" 
                class="px-3 py-1 border border-gray-300 rounded text-sm">
            <option value="-start_date" {% if current_sort == '-start_date' %}selected{% endif %}>Newest First</option>
            <option value="start_date" {% if current_sort == 'start_date' %}selected{% endif %}>Oldest First</option>
            <option value="title" {% if current_sort == 'title' %}selected{% endif %}>Name A-Z</option>
            <option value="-title" {% if current_sort == '-title' %}selected{% endif %}>Name Z-A</option>
            <option value="-end_date" {% if current_sort == '-end_date' %}selected{% endif %}>Deadline Soon</option>
        </select>
    </div>
</div>


{% if programs %}
<!-- Programs Grid -->
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8" x-data="staggerAnimation({staggerDelay: 150})">
    {% for program in programs %}
    <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden hover:shadow-lg hover:border-primary-300 transition-all duration-300 animate-fade-in-up" 
         x-data="hoverAnimation()">
        
        <!-- Program Header -->
        <div class="p-6 pb-4">
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center">
                    <div class="bg-primary-100 p-3 rounded-full mr-4 flex-shrink-0">
                        <i class="fas fa-hand-holding-heart text-xl text-primary-600"></i>
                    </div>
                    <div>
                        <div class="text-sm text-primary-700 font-semibold uppercase tracking-wide">{{ program.category }}</div>
                        <div class="text-xs text-gray-500 mt-0.5">{{ program.ministry }}</div>
                    </div>
                </div>
                {% if program.is_featured %}
                <span class="bg-orange-500 text-white text-xs px-3 py-1 rounded-full font-bold flex items-center shadow-sm">
                    <i class="fas fa-star mr-1.5 text-yellow-300"></i>Featured
                </span>
                {% endif %}
            </div>
            
            <h3 class="text-xl font-bold text-slate-800 mb-2 line-clamp-2">{{ program.title }}</h3>
            <p class="text-gray-600 text-base mb-4 line-clamp-3">{{ program.description }}</p>
            
            <!-- Program Details -->
            <div class="space-y-3 text-sm">
                {% if program.application_deadline %}
                <div class="flex items-center text-gray-700">
                    <i class="fas fa-clock text-primary-500 w-5 mr-3 flex-shrink-0"></i>
                    <span>Deadline: <span class="font-medium">{{ program.application_deadline|date:"M d, Y" }}</span></span>
                </div>
                {% endif %}
                {% if program.eligibility %}
                <div class="flex items-start text-gray-700">
                    <i class="fas fa-users text-indigo-500 w-5 mr-3 flex-shrink-0 mt-0.5"></i>
                    <span class="line-clamp-2">{{ program.eligibility }}</span>
                </div>
                {% endif %}
                {% if program.geographic_coverage %}
                <div class="flex items-center text-gray-700">
                    <i class="fas fa-map-marker-alt text-red-500 w-5 mr-3 flex-shrink-0"></i>
                    <span>Coverage: <span class="font-medium">{{ program.geographic_coverage }}</span></span>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Program Footer -->
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <span class="text-xs px-3 py-1.5 rounded-full font-semibold 
                        {% if 'Active' in program.status %}bg-success-100 text-success-700
                        {% elif 'Pending' in program.status %}bg-warning-100 text-warning-700
                        {% else %}bg-gray-200 text-gray-700{% endif %}">
                        {{ program.status }}
                    </span>
                    {% if program.priority %}
                    <span class="ml-3 text-xs text-gray-600 font-medium">{{ program.priority }} Priority</span>
                    {% endif %}
                </div>
                <div class="flex space-x-3">
                    <a href="{% url 'application_form' %}" 
                       class="inline-flex items-center justify-center font-medium rounded-md transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 px-4 py-2 text-sm bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500"
                       onclick="return checkAuthAndApply(event)">
                        Apply <i class="fas fa-external-link-alt ml-2"></i>
                    </a>
                    <a href="{% url 'ministry_program_detail' program.slug %}" class="inline-flex items-center justify-center font-medium rounded-md transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 px-4 py-2 text-sm border border-gray-300 text-gray-700 hover:bg-gray-100 focus:ring-gray-300">
                        Details <i class="fas fa-info-circle ml-2"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% else %}
    <!-- Empty State -->
    <div class="col-span-full text-center py-12">
        <div class="max-w-md mx-auto">
            <div class="text-6xl text-gray-300 mb-4">
                <i class="fas fa-building"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-700 mb-2">No Ministry Programs Found</h3>
            <p class="text-gray-500 mb-6">
                {% if current_sector %}
                No programs found in the selected sector. Try browsing all programs or select a different sector.
                {% else %}
                No ministry programs are currently available. Please check back later for updates.
                {% endif %}
            </p>
            {% if current_sector %}
            <a href="{% url 'accessible_ministry_programs' %}" class="inline-flex items-center justify-center font-medium rounded-md transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 px-4 py-2 text-sm bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500">
                <i class="fas fa-th-large mr-2"></i>
                View All Programs
            </a>
            {% endif %}
        </div>
    </div>
{% endif %}

<!-- Frequently Asked Questions -->
<div class="bg-white rounded-lg shadow-sm p-8 border border-gray-100 mb-8">
    <h2 class="text-2xl font-bold text-slate-800 mb-6">Frequently Asked Questions about Ministry Programs</h2>

    <div class="space-y-4">
        {% for faq in page_faqs %}
        <div class="border border-gray-200 rounded-lg overflow-hidden faq-item">
            <button class="w-full text-left px-6 py-4 font-medium flex justify-between items-center focus:outline-none hover:bg-gray-50 transition-colors faq-button" type="button">
                <span>{{ faq.question }}</span>
                <i class="fas fa-chevron-down text-gray-400 faq-icon"></i>
            </button>
            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 faq-content" style="max-height: 0px; overflow: hidden; transition: max-height 0.3s ease;">
                <p class="text-gray-600">{{ faq.answer }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block cta %}
{% endblock %}

{% block extra_js %}
<script>
// Enhanced animations and interactions for ministry programs
document.addEventListener('DOMContentLoaded', function() {
    // Stagger animation for program cards
    window.staggerAnimation = function(config = {}) {
        return {
            init() {
                const delay = config.staggerDelay || 100;
                const elements = this.$el.querySelectorAll('.animate-fade-in-up');
                elements.forEach((el, index) => {
                    setTimeout(() => {
                        el.classList.add('opacity-100', 'translate-y-0');
                    }, index * delay);
                });
            }
        }
    }
    
    // Hover animation for program cards
    window.hoverAnimation = function() {
        return {
            isHovered: false,
            init() {
                this.$el.addEventListener('mouseenter', () => this.isHovered = true);
                this.$el.addEventListener('mouseleave', () => this.isHovered = false);
            }
        }
    }

    // FAQ accordion functionality - only one open at a time
    const faqButtons = document.querySelectorAll('.faq-button');
    let currentlyOpenButton = null;

    faqButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const content = this.nextElementSibling;
            const icon = this.querySelector('.faq-icon');

            // Close the currently open button if it's different
            if (currentlyOpenButton && currentlyOpenButton !== this) {
                const previousContent = currentlyOpenButton.nextElementSibling;
                const previousIcon = currentlyOpenButton.querySelector('.faq-icon');

                if (previousContent && previousIcon) {
                    previousContent.style.maxHeight = '0px';
                    previousIcon.classList.remove('fa-chevron-up');
                    previousIcon.classList.add('fa-chevron-down');
                }
            }

            // Toggle the clicked button
            if (content && icon) {
                if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                    content.style.maxHeight = '0px';
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                    currentlyOpenButton = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + 'px';
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                    currentlyOpenButton = this;
                }
            }
        });
    });

    // Initialize all content to be completely hidden
    const faqContents = document.querySelectorAll('.faq-content');
    faqContents.forEach(content => {
        content.style.maxHeight = '0px';
        content.style.overflow = 'hidden';
    });
});
</script>
{% endblock %}
